package wtf.diablo.module.impl.Exploits;

import com.google.common.eventbus.Subscribe;
import net.minecraft.item.ItemBow;
import net.minecraft.network.play.client.C03PacketPlayer;
import wtf.diablo.events.impl.UpdateEvent;
import wtf.diablo.module.Module;
import wtf.diablo.module.data.Category;
import wtf.diablo.module.data.ServerType;
import wtf.diablo.settings.impl.NumberSetting;
import wtf.diablo.utils.math.Stopwatch;

public class FastBow extends Module {
    public NumberSetting delay = new NumberSetting("Delay", 100, 1,0,750);
    public FastBow() {
        super("FastBow", "Shoots bow arrow fast fast fast", Category.EXPLOIT, ServerType.All);
        addSettings(delay);
    }
    Stopwatch timer = new Stopwatch();


    public void onDisable(){
        mc.rightClickDelayTimer = 6;
    }

    @Subscribe
    public void onUpdate(UpdateEvent e) {
        if(isToggled())
        if(mc.thePlayer.getHeldItem() != null && mc.thePlayer.getHeldItem().getItem() instanceof ItemBow && mc.thePlayer.isUsingItem()) {
            if (timer.hasReached(delay.getValue())) {
                for (int i = 0; i < 20; i++) {
                    mc.rightClickDelayTimer = 0;
                    mc.thePlayer.sendQueue.addToSendQueueSilent(new C03PacketPlayer.C06PacketPlayerPosLook(mc.thePlayer.posX, mc.thePlayer.posY, mc.thePlayer.posZ, mc.thePlayer.rotationYaw, mc.thePlayer.rotationPitch, mc.thePlayer.onGround));
                }
                mc.playerController.onStoppedUsingItem(mc.thePlayer);
                timer.reset();
            }
        }else{
            mc.rightClickDelayTimer = 0;
        }
    }
}
